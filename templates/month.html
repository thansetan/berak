{{ define "month" }}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@thansetan" />
        <meta name="twitter:author" content="@thansetan" />
        <meta
            name="twitter:title"
            content="{{ getMonthName .Month }} {{.Year}} | ðŸ’© Log"
        />
        <meta
            name="twitter:description"
            content="thansetan's poop log of
            {{getMonthName .Month}} {{.Year}}"
        />
        <meta
            name="twitter:image"
            content="https://poop.thansetan.foo/img/poop.png"
        />

        <meta
            property="og:title"
            content="{{ getMonthName .Month }} {{.Year}} | ðŸ’© Log"
        />
        <meta
            property="og:description"
            content="thansetan's poop log of
            {{getMonthName .Month}} {{.Year}}"
        />
        <meta property="og:type" content="website" />
        <meta
            property="og:url"
            content="https://poop.thansetan.foo/{{.Year}}/{{.Month}}"
        />
        <meta
            property="og:image"
            content="https://poop.thansetan.foo/img/poop.png"
        />

        <title>{{ getMonthName .Month }} {{.Year}} | ðŸ’© Log</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’©</text></svg>"
        />
        <style>
            table {
                width: 50%;
            }
            @media (max-width: 768px) {
                table {
                    width: 100%;
                }
            }
        </style>
    </head>
    <body style="max-width: 80vw; margin: 0 auto">
        <header>
            <nav
                style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                "
            >
                {{ if gt .Month 1 }} {{ $prevMonth := add .Month -1 }}
                <a href="/{{.Year}}/{{ $prevMonth }}"
                    >{{ getMonthName $prevMonth }}</a
                >
                {{ else }}
                <a href="/{{add .Year -1}}/12"
                    >{{ getMonthName 12 }} {{add .Year -1}}</a
                >
                {{ end }}
                <h1>{{getMonthName .Month}}</h1>
                {{ if lt .Month 12 }} {{ $nextMonth := add .Month 1 }}
                <a href="/{{.Year}}/{{ $nextMonth }}"
                    >{{ getMonthName $nextMonth }}</a
                >
                {{ else }}
                <a href="/{{add .Year 1}}/1"
                    >{{ getMonthName 1 }} {{add .Year 1}}</a
                >
                {{ end }}
            </nav>
        </header>
        <main style="text-align: center; min-height: 65vh">
            <div id="poop-log" style="padding: 30px 15px">
                <h1 style="text-align: center">
                    ðŸ’© {{getMonthName .Month}} {{ .Year }} ðŸ’©
                </h1>
                <table style="margin: 0 auto; border-collapse: collapse">
                    <tr>
                        <th style="border: 1px solid black; font-weight: bold">
                            Day
                        </th>
                        <th style="border: 1px solid black; font-weight: bold">
                            Count
                        </th>
                    </tr>
                    {{ $sum := 0 }} {{ with .Data }} {{ range . }}
                    <tr style="text-align: center">
                        <td style="border: 1px solid black">{{ .Period }}</td>
                        <td style="border: 1px solid black">
                            {{ tai .Count }}
                        </td>
                    </tr>
                    {{ $sum = add $sum .Count }} {{ end }} {{ end }}
                    <tr style="text-align: center">
                        <td style="border: 1px solid black; font-weight: bold">
                            Total
                        </td>
                        <td style="border: 1px solid black; font-weight: bold">
                            {{ $sum }}
                        </td>
                    </tr>
                </table>
            </div>
            <button onclick="saveImage()" style="margin-top: 20px">
                Save as Image
            </button>
        </main>
        <footer>
            <p style="text-align: center; font-weight: bold">
                Last ðŸ’© on {{ .LastDataAt.Format "02 January 2006 at 15:04" }}
                GMT+7
            </p>
        </footer>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"
            integrity="sha512-01CJ9/g7e8cUmY0DFTMcUw/ikS799FHiOA0eyHsUWfOetgbx/t6oV4otQ5zXKQyIrQGTHSmRVPIgrgLcZi/WMA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script>
            const saveImage = () => {
                const node = document.querySelector('#poop-log')
                domtoimage
                    .toPng(node, {
                        bgcolor: 'white',
                    })
                    .then(function (dataUrl) {
                        const link = document.createElement('a')
                        link.download = `poop-log-{{.Year}}-${'{{.Month}}'.padStart(
                            2,
                            '0'
                        )}.png`
                        link.href = dataUrl
                        link.click()
                    })
            }
        </script>
    </body>
</html>

{{ end }}
